{"ast":null,"code":"import{useEffect,useState,useRef}from\"react\";import DashboardCards from\"../components/DashboardCards\";import CategoryList from\"../components/CategoryList\";import TopBestCrops from\"../components/TopBestCrops\";import{speakBestMarket}from\"../utils/speakPrice\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function Dashboard(){const[data,setData]=useState([]);const[selectedCategory,setSelectedCategory]=useState(null);const hasSpoken=useRef(false);// ðŸ”„ Load data\nuseEffect(()=>{fetch(\"http://127.0.0.1:5000/api/data\").then(res=>res.json()).then(json=>{setData(json);}).catch(err=>console.error(err));},[]);// ðŸ”Š MANUAL TRIGGER (IMPORTANT FOR BROWSER)\nconst handleSpeakBestMarket=()=>{if(!data.length)return;// ðŸ•’ Time-based greeting\nconst hour=new Date().getHours();let greeting=\"Good evening\";if(hour<12)greeting=\"Good morning\";else if(hour<17)greeting=\"Good afternoon\";// â­ Find best market\nconst best=data.reduce((max,cur)=>Number(cur.Modal_x0020_Price)>Number(max.Modal_x0020_Price)?cur:max);const crop=best.Commodity||best.commodity||best.Crop||best.crop_name;speakBestMarket({crop,market:best.Market,state:best.State,price:best.Modal_x0020_Price,greeting});// Save spoken date\nlocalStorage.setItem(\"spokenDate\",new Date().toDateString());hasSpoken.current=true;};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{style:{padding:\"15px\"},children:/*#__PURE__*/_jsx(\"button\",{onClick:handleSpeakBestMarket,style:{padding:\"12px 20px\",fontSize:\"16px\",borderRadius:\"8px\",border:\"none\",background:\"#2e7d32\",color:\"white\",cursor:\"pointer\"},children:\"\\uD83D\\uDD0A Hear Today\\u2019s Best Market\"})}),/*#__PURE__*/_jsx(DashboardCards,{data:data,onCategoryClick:setSelectedCategory}),/*#__PURE__*/_jsx(TopBestCrops,{data:data}),selectedCategory&&/*#__PURE__*/_jsx(CategoryList,{data:data,category:selectedCategory})]});}export default Dashboard;","map":{"version":3,"names":["useEffect","useState","useRef","DashboardCards","CategoryList","TopBestCrops","speakBestMarket","jsx","_jsx","jsxs","_jsxs","Dashboard","data","setData","selectedCategory","setSelectedCategory","hasSpoken","fetch","then","res","json","catch","err","console","error","handleSpeakBestMarket","length","hour","Date","getHours","greeting","best","reduce","max","cur","Number","Modal_x0020_Price","crop","Commodity","commodity","Crop","crop_name","market","Market","state","State","price","localStorage","setItem","toDateString","current","children","style","padding","onClick","fontSize","borderRadius","border","background","color","cursor","onCategoryClick","category"],"sources":["C:/Users/Deepak K C/Desktop/best_time_to_sell_crop/frontend/src/pages/Dashboard.js"],"sourcesContent":["import { useEffect, useState, useRef } from \"react\";\r\nimport DashboardCards from \"../components/DashboardCards\";\r\nimport CategoryList from \"../components/CategoryList\";\r\nimport TopBestCrops from \"../components/TopBestCrops\";\r\nimport { speakBestMarket } from \"../utils/speakPrice\";\r\n\r\nfunction Dashboard() {\r\n  const [data, setData] = useState([]);\r\n  const [selectedCategory, setSelectedCategory] = useState(null);\r\n  const hasSpoken = useRef(false);\r\n\r\n  // ðŸ”„ Load data\r\n  useEffect(() => {\r\n    fetch(\"http://127.0.0.1:5000/api/data\")\r\n      .then(res => res.json())\r\n      .then(json => {\r\n        setData(json);\r\n      })\r\n      .catch(err => console.error(err));\r\n  }, []);\r\n\r\n  // ðŸ”Š MANUAL TRIGGER (IMPORTANT FOR BROWSER)\r\n  const handleSpeakBestMarket = () => {\r\n    if (!data.length) return;\r\n\r\n    // ðŸ•’ Time-based greeting\r\n    const hour = new Date().getHours();\r\n    let greeting = \"Good evening\";\r\n    if (hour < 12) greeting = \"Good morning\";\r\n    else if (hour < 17) greeting = \"Good afternoon\";\r\n\r\n    // â­ Find best market\r\n    const best = data.reduce((max, cur) =>\r\n      Number(cur.Modal_x0020_Price) >\r\n      Number(max.Modal_x0020_Price)\r\n        ? cur\r\n        : max\r\n    );\r\n\r\n    const crop =\r\n      best.Commodity ||\r\n      best.commodity ||\r\n      best.Crop ||\r\n      best.crop_name;\r\n\r\n    speakBestMarket({\r\n      crop,\r\n      market: best.Market,\r\n      state: best.State,\r\n      price: best.Modal_x0020_Price,\r\n      greeting\r\n    });\r\n\r\n    // Save spoken date\r\n    localStorage.setItem(\r\n      \"spokenDate\",\r\n      new Date().toDateString()\r\n    );\r\n    hasSpoken.current = true;\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      {/* ðŸ”Š VOICE BUTTON */}\r\n      <div style={{ padding: \"15px\" }}>\r\n        <button\r\n          onClick={handleSpeakBestMarket}\r\n          style={{\r\n            padding: \"12px 20px\",\r\n            fontSize: \"16px\",\r\n            borderRadius: \"8px\",\r\n            border: \"none\",\r\n            background: \"#2e7d32\",\r\n            color: \"white\",\r\n            cursor: \"pointer\"\r\n          }}\r\n        >\r\n          ðŸ”Š Hear Todayâ€™s Best Market\r\n        </button>\r\n      </div>\r\n\r\n      {/* DASHBOARD CARDS */}\r\n      <DashboardCards\r\n        data={data}\r\n        onCategoryClick={setSelectedCategory}\r\n      />\r\n\r\n      {/* TOP CROPS */}\r\n      <TopBestCrops data={data} />\r\n\r\n      {/* CATEGORY DETAILS */}\r\n      {selectedCategory && (\r\n        <CategoryList\r\n          data={data}\r\n          category={selectedCategory}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Dashboard;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}